<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏ö‡πâ‡∏≤‡∏ô‡∏û‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà</title>
  <link rel="manifest" href="manifest.json">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;500;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Sarabun', sans-serif; background: #fff8f0; color: #4e342e; }
    .menu-item { display: flex; align-items: center; cursor: pointer; padding: 12px; margin-bottom: 8px; border-radius: 12px; background: #fff; box-shadow: 0 2px 8px #0001; transition: background 0.2s; }
    .menu-item:hover { background: #ffe0b2; }
    .menu-icon { font-size: 1.7rem; margin-right: 18px; }
    .menu-name { flex-grow: 1; }
    .menu-price { min-width: 70px; text-align: right; }
    .btn, select, input { font-size: 1.1rem; }
    @media (max-width: 600px) { .menu-item { font-size: 0.98rem; } }
    .fixed-bottom-btn { position: fixed; bottom: 20px; right: 20px; z-index: 2000; }
  </style>
</head>
<body>
  <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ò‡∏µ‡∏° -->
  <button id="themeToggle" class="btn btn-light fixed-bottom-btn" aria-label="‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ò‡∏µ‡∏°">
    <i class="bi bi-moon-stars-fill"></i>
  </button>
  <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏©‡∏≤ -->
  <div class="text-end mt-2 mb-1">
    <button class="btn btn-outline-secondary btn-sm" onclick="switchLanguage('th')">üáπüá≠</button>
    <button class="btn btn-outline-secondary btn-sm" onclick="switchLanguage('en')">üá¨üáß</button>
  </div>
  <div class="container">
    <h2 class="text-center my-3" id="appTitle">‡∏ö‡πâ‡∏≤‡∏ô‡∏û‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà</h2>
    <!-- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏°‡∏ô‡∏π -->
    <input type="text" id="searchMenu" class="form-control mb-3" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏°‡∏ô‡∏π...">
    <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π -->
    <div class="mb-4" id="menuList"></div>
    <!-- ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå -->
    <div class="card mb-4">
      <div class="card-header bg-primary text-white"><b id="orderHeader">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</b></div>
      <div class="card-body">
        <div id="orderList"></div>
        <div class="d-flex justify-content-between mt-3">
          <button class="btn btn-danger" id="clearOrderBtn"><i class="bi bi-trash"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
          <button class="btn btn-success" id="sendOrderBtn"><i class="bi bi-send-check"></i> ‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
        </div>
        <div id="statusMsg" class="alert mt-3" style="display:none;"></div>
      </div>
    </div>
    <!-- Modal ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à -->
    <div class="modal fade" id="receiptModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header"><h5 class="modal-title" id="receiptTitle">‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</h5></div>
          <div class="modal-body" id="receiptContent"></div>
          <div class="modal-footer">
            <button onclick="printReceipt()" class="btn btn-outline-secondary" id="printBtn"><i class="bi bi-printer"></i> ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</button>
            <button class="btn btn-secondary" data-bs-dismiss="modal" id="closeModalBtn">‡∏õ‡∏¥‡∏î</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Main Script -->
  <script>
    // PWA Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js');
    }

    // Translation
    const translations = {
      th: {
        appTitle: "‡∏ö‡πâ‡∏≤‡∏ô‡∏û‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà",
        searchMenu: "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏°‡∏ô‡∏π...",
        orderHeader: "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠",
        clearOrderBtn: "‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£",
        sendOrderBtn: "‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå",
        receiptTitle: "‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô",
        printBtn: "‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à",
        closeModalBtn: "‡∏õ‡∏¥‡∏î",
        addToOrderSuccess: "‡πÄ‡∏û‡∏¥‡πà‡∏° {itemName} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢",
        removeFromOrderSuccess: "‡∏•‡∏ö {itemName} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢",
        orderSuccess: "‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à üéâ",
        noItemsSelected: "‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£",
        orderCleared: "‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢",
        qty: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô",
        price: "‡∏£‡∏≤‡∏Ñ‡∏≤",
        total: "‡∏£‡∏ß‡∏°",
        menu: "‡πÄ‡∏°‡∏ô‡∏π"
      },
      en: {
        appTitle: "Teacher's Home Cafe",
        searchMenu: "Search menu...",
        orderHeader: "Order List",
        clearOrderBtn: "Clear Order",
        sendOrderBtn: "Send Order",
        receiptTitle: "Receipt",
        printBtn: "Print Receipt",
        closeModalBtn: "Close",
        addToOrderSuccess: "Added {itemName} to order",
        removeFromOrderSuccess: "Removed {itemName} from order",
        orderSuccess: "Order sent successfully üéâ",
        noItemsSelected: "Please select at least 1 item",
        orderCleared: "Order cleared",
        qty: "Qty",
        price: "Price",
        total: "Total",
        menu: "Menu"
      }
    };

    let currentLang = "th";
    let menuItems = [];
    let orders = [];

    // Load menu from JSON
    async function loadMenu() {
      const res = await fetch('menu.json');
      menuItems = await res.json();
      renderMenu();
    }

    // Load orders from localStorage
    function loadOrders() {
      const saved = localStorage.getItem('orders');
      if (saved) orders = JSON.parse(saved);
    }
    // Save orders to localStorage
    function saveOrders() {
      localStorage.setItem('orders', JSON.stringify(orders));
    }

    function getTranslation(key, placeholders = {}) {
      let text = translations[currentLang][key] || key;
      for (const p in placeholders) text = text.replace(`{${p}}`, placeholders[p]);
      return text;
    }

    // Render Menu
    function renderMenu(filterList = null) {
      const list = filterList || menuItems;
      let html = "";
      if (!list.length) {
        html = `<div class="text-muted text-center">- ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏°‡∏ô‡∏π -</div>`;
      } else {
        html = list.map(item => `
          <div class="menu-item" onclick="addOrder(${item.id})" tabindex="0" aria-label="${item['name_'+currentLang]}">
            <div class="menu-icon">${item.icon}</div>
            <div class="menu-name">${item['name_'+currentLang]}</div>
            <div class="menu-price">${item.price}‡∏ø</div>
          </div>
        `).join('');
      }
      document.getElementById('menuList').innerHTML = html;
    }

    // Menu search
    document.getElementById('searchMenu').addEventListener('input', function(e) {
      const kw = e.target.value.toLowerCase();
      const filtered = menuItems.filter(item => 
        item['name_'+currentLang].toLowerCase().includes(kw)
      );
      renderMenu(filtered);
    });

    // Add Order
    window.addOrder = function(id) {
      const item = menuItems.find(i => i.id === id);
      const exist = orders.find(o => o.id === id);
      if (exist) exist.qty++;
      else orders.push({...item, qty: 1});
      renderOrders();
      saveOrders();
      showStatus(getTranslation('addToOrderSuccess', {itemName: item['name_'+currentLang]}), 'success');
    };

    // Remove Order
    window.removeOrder = function(id) {
      orders = orders.filter(o => o.id !== id);
      renderOrders();
      saveOrders();
      showStatus(getTranslation('removeFromOrderSuccess', {itemName: ''}), 'danger');
    };

    // Render Orders
    function renderOrders() {
      let html = "";
      let total = 0;
      if (!orders.length) html = `<div class="text-muted text-center">- ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ -</div>`;
      else {
        html = `<table class="table table-sm">
          <thead><tr>
            <th>${getTranslation('menu')}</th>
            <th>${getTranslation('qty')}</th>
            <th>${getTranslation('price')}</th>
            <th>${getTranslation('total')}</th>
            <th></th>
          </tr></thead>
          <tbody>`;
        orders.forEach(order => {
          const itemTotal = order.price * order.qty;
          total += itemTotal;
          html += `<tr>
            <td>${order['name_'+currentLang]}</td>
            <td>
              <button class="btn btn-outline-secondary btn-sm" onclick="changeQty(${order.id}, -1)" aria-label="‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">-</button>
              ${order.qty}
              <button class="btn btn-outline-secondary btn-sm" onclick="changeQty(${order.id}, 1)" aria-label="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">+</button>
            </td>
            <td>${order.price}</td>
            <td>${itemTotal}</td>
            <td><button class="btn btn-danger btn-sm" onclick="removeOrder(${order.id})"><i class="bi bi-x-lg"></i></button></td>
          </tr>`;
        });
        html += `</tbody>
          <tfoot><tr>
            <th colspan="3" class="text-end">${getTranslation('total')}</th>
            <th>${total}</th>
            <th></th>
          </tr></tfoot>
        </table>`;
      }
      document.getElementById('orderList').innerHTML = html;
    }

    // Change Qty
    window.changeQty = function(id, delta) {
      const order = orders.find(o => o.id === id);
      if (!order) return;
      order.qty += delta;
      if (order.qty < 1) order.qty = 1;
      renderOrders();
      saveOrders();
    };

    // Clear Order
    document.getElementById('clearOrderBtn').onclick = function() {
      if (orders.length && confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£?")) {
        orders = [];
        renderOrders();
        saveOrders();
        showStatus(getTranslation('orderCleared'), 'info');
      }
    };

    // Send Order (show receipt)
    document.getElementById('sendOrderBtn').onclick = function() {
      if (!orders.length) {
        showStatus(getTranslation('noItemsSelected'), 'danger');
        return;
      }
      showReceipt();
      orders = [];
      renderOrders();
      saveOrders();
      showStatus(getTranslation('orderSuccess'), 'success');
    };

    // Show Status
    function showStatus(msg, type) {
      const el = document.getElementById('statusMsg');
      el.textContent = msg;
      el.className = "alert alert-"+type;
      el.style.display = "block";
      setTimeout(()=> el.style.display = "none", 2500);
    }

    // Show Receipt Modal
    function showReceipt() {
      let total = 0;
      let html = `<h5 class="text-center mb-3">${getTranslation('receiptTitle')}</h5>
        <table class="table">
        <thead><tr>
          <th>${getTranslation('menu')}</th>
          <th>${getTranslation('qty')}</th>
          <th>${getTranslation('price')}</th>
          <th>${getTranslation('total')}</th>
        </tr></thead>
        <tbody>`;
      orders.forEach(order => {
        const itemTotal = order.price * order.qty;
        total += itemTotal;
        html += `<tr>
          <td>${order['name_'+currentLang]}</td>
          <td>${order.qty}</td>
          <td>${order.price}</td>
          <td>${itemTotal}</td>
        </tr>`;
      });
      html += `</tbody>
        <tfoot><tr>
          <th colspan="3" class="text-end">${getTranslation('total')}</th>
          <th>${total}</th>
        </tr></tfoot>
        </table>
        <div class="text-center mt-3">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£!</div>`;
      document.getElementById('receiptContent').innerHTML = html;
      new bootstrap.Modal(document.getElementById('receiptModal')).show();
    }
    // Print Receipt
    window.printReceipt = function() {
      const printContent = document.getElementById('receiptContent').innerHTML;
      const originalContent = document.body.innerHTML;
      document.body.innerHTML = printContent;
      window.print();
      document.body.innerHTML = originalContent;
      location.reload();
    }

    // Switch Language
    window.switchLanguage = function(lang) {
      currentLang = lang;
      document.getElementById('appTitle').textContent = getTranslation('appTitle');
      document.getElementById('searchMenu').placeholder = getTranslation('searchMenu');
      document.getElementById('orderHeader').textContent = getTranslation('orderHeader');
      document.getElementById('clearOrderBtn').innerHTML = `<i class="bi bi-trash"></i> ${getTranslation('clearOrderBtn')}`;
      document.getElementById('sendOrderBtn').innerHTML = `<i class="bi bi-send-check"></i> ${getTranslation('sendOrderBtn')}`;
      document.getElementById('printBtn').innerHTML = `<i class="bi bi-printer"></i> ${getTranslation('printBtn')}`;
      document.getElementById('closeModalBtn').textContent = getTranslation('closeModalBtn');
      renderMenu();
      renderOrders();
    };

    // Theme Toggle
    document.getElementById('themeToggle').onclick = function() {
      document.body.classList.toggle('bg-dark');
      document.body.classList.toggle('text-white');
    };

    // Init
    window.onload = async function() {
      loadOrders();
      await loadMenu();
      renderOrders();
    };
  </script>
</body>
</html>
